<%- include ('../partials/head') %>
<%- include ('../partials/nav') %>




<script>
    console.log("jobsort array",jobs)
    // // Initialize an empty array to store jobs
    
    
    
    // Function to toggle the job description visibility
    function toggleDescription(jobId) {
        var description = document.getElementById('description' + jobId);
        description.style.display = (description.style.display === 'none' || description.style.display === '') ? 'block' : 'none';
    }

    // Function to sort jobs by date
    function sortByDate(order) {
        //console.log(jobsSort)
        jobs.sort(function (a, b) {
            var dateA = new Date(a.date_posted);
            var dateB = new Date(b.date_posted);
            console.log(dateA)
            console.log(dateB)


            console.log("Sort accessed")

            return order === 'asc' ? dateA - dateB : dateB - dateA;
        });
        renderJobCards();
    }

    // Function to render job cards
    function renderJobCards() {
        var jobCardsContainer = document.querySelector('.job-cards-container');
        jobCardsContainer.innerHTML = '';

        jobs.forEach(function (job) {
            var card = document.createElement('div');
            card.className = 'card';
            card.style = 'width: 30rem;';

            var formattedDate = parseDate(job.date_posted);

            card.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${job.role}</h5>
                    <p class="card-text">Company: ${job.company}</p>
                    <p class="card-text">Location: ${job.location}</p>
                    <p class="card-text">Date Posted: ${formattedDate}</p>
                    <button class="btn btn-info" onclick="toggleDescription('${job.id}')">Show Description</button>
                    <div class="job-description" id="description${job.id}" style="display: none;">
                        ${job.description}
                        <a href="${job.application_link}" class="btn btn-primary">Apply</a>
                    </div>
                </div>
            `;

            jobCardsContainer.appendChild(card);
        });
    }

    // Function to sort by date and render job cards
    function sortByDateAndRender(order) {
        console.log("SortByDate and Render")
        console.log(order)
        sortByDate(order);
        renderJobCards();
    }

    
</script>


<style>
    body {
      padding-top: 20px;
    }
  
    .container {
      max-width: 800px; /* Adjust based on your design preferences */
      margin: 0 auto;
    }
  
    .job-cards-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }
  
    .card {
      margin-bottom: 20px;
    }

    #sortOrder {
        width: 50%; 
    }
  </style>
  


<%
function parseDate(dateString) {
    var parts = dateString.split(/[-T:Z.]/);
    var dateObject = new Date(Date.UTC(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5], parts[6]));
    var formattedDate = (dateObject.getMonth() + 1).toString().padStart(2, '0') +
                        '/' +
                        dateObject.getDate().toString().padStart(2, '0') +
                        '/' +
                        dateObject.getFullYear();
                        
    return formattedDate;
}
%>



<main>
    <div class="container">
        
            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" id="sortOrder">
                <option selected>Sort by Date:</option>
                <option value="asc">Ascending</option>
                <option value="desc">Descending</option>
              </select>
            
        

        <div class="job-container">
            <div class="job-cards-container">
                <% jobs.forEach(function(job) {%>
                    <div class="card" style="width: 30rem;">
                        <div class="card-body">
                            <h5 class="card-title"><%= job.role %></h5>
                            <p class="card-text">Company: <%= job.company %></p>
                            <p class="card-text">Location: <%= job.location %></p>
                            <p class="card-text">Date Posted: <%= parseDate(job.date_posted) %></p>
                            <button class="btn btn-info" onclick="toggleDescription('<%= job.id %>')">Learn More</button>
                            <div class="job-description" id="description<%= job.id %>" style="display: none;">
                                <br>
                                 <% var sponsorship = ''
                                 if(job.offers_sponsorship == 0) { sponsorship = "No"}
                                 else {
                                    sponsorship = "Yes"
                                 } %>

                                <% var citizenship = ''
                                 if(job.requires_us_citizenship == 0) { citizenship = "No"}
                                 else {
                                    citizenship = "Yes"
                                 } %>
                                 
                            
                                <% var jobType = ''
                                 if(job.internship == 0) { jobType = "Employee"}
                                 else {
                                    jobType = "Internship"
                                 } %> 
                                 <div class="d-grid gap-3">
                                    <div class="p-2 bg-light border">Offers Sponsorship: <%= sponsorship%></div>
                                    <div class="p-2 bg-light border">Requires US Citizenship: <%= citizenship %></div>
                                    <div class="p-2 bg-light border">Job Type: <%= jobType %></div>
                                  </div>
                                  <br>
                                <a href="<%= job.application_link %>" class="btn btn-primary">Apply</a>
                            </div>
                        
                        </div>
                    </div><br>
                <% }) %>
            </div>
            
        </div>
    </div>
</main>

<script> 
// Example event listener for the "Sort by Date" button
document.getElementById('sortOrder').addEventListener('change', function () {
        console.log("Last step")
        var order = document.getElementById('sortOrder').value;
        sortByDateAndRender(order);
    });
</script>


<%- include ('../partials/footer') %>

